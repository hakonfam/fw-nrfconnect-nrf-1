#
# Copyright (c) 2020 Nordic Semiconductor ASA
#
# SPDX-License-Identifier: LicenseRef-BSD-5-Clause-Nordic
#

menuconfig FMFU_FDEV
	bool "Full Modem Firmware Upgrade from flash device"
	depends on CDDL_GEN


if (FMFU_FDEV)

choice
	prompt "FMFU CDDL decoder build strategy"
	default FMFU_CDDL_DECODER_BUILD_STRATEGY_SOURCE
	help
	  The metadata contained in the FMFU binary is encoded using CDDL.
	  The decoder used for parsing this data is generated using cddl-gen.
	  The generated decoder is committed to the repository since the format
	  mostly will remain unchanged. The format is defined in the file
	  'modem_update.cddl'. New source files must be generated if this file
	  changes.

config FMFU_CDDL_DECODER_BUILD_STRATEGY_SOURCE
	bool "Use committed CDDL decoder source files"
	help
	  Select this option as long as 'modem_update.cddl' is unchanged.

config FMFU_CDDL_DECODER_BUILD_STRATEGY_GENERATE
	bool "Use cddl-gen python script to generate CDDL decoder source files"
	help
	  Select this option to re-generate the files needed to decode the
	  modem update CDDL. This is only needed if the format defined in
	  'modem_update.cddl' has been changed. Run the
	  'fmfu_cddl_modem_update_install' target to install the generated files
	  to the source directory.

endchoice

config MBEDTLS_HEAP_SIZE
	int
	default 4096

config FMFU_FDEV_SKIP_PREVALIDATION
	bool "Skip prevalidation of modem firmware"
	help
	  Set this option to skip prevalidation of the modem firmware. Note
	  that the modem will still verify the validity of the modem firmmware
	  before booting it, but only after it has been written to the modem.
	  This option

if FMFU_FDEV_SKIP_PREVALIDATION
	comment "FMFU_FDEV_SKIP_PREVALIDATE should ONLY be used during development"
endif

module=FMFU_FDEV
module-dep=LOG
module-str=FMFU FDEV
source "${ZEPHYR_BASE}/subsys/logging/Kconfig.template.log_config"

endif # FMFU_FDEV
